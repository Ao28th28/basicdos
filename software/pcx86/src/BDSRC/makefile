#
# BASIC-DOS Makefile
#
# @author Jeff Parsons <Jeff@pcjs.org>
# @copyright Â© 2012-2020 Jeff Parsons
# @license MIT <https://www.pcjs.org/LICENSE.txt>
#
# This file is part of PCjs, a computer emulation software project at pcjs.org
#
ASM=MASM
LINK=LINK
EXE2BIN=EXE2BIN

.ASM.COM:
	$(ASM) /IINC $**,$*.OBJ;
	$(LINK) $*.OBJ,$*.EXE;
	$(EXE2BIN) $*.EXE $@
	DEL $*.OBJ
	DEL $*.EXE

.ASM.OBJ:
	$(ASM) /IINC $**,$@;

.ASM.LST:
	$(ASM) /IINC $**,$@,$*.LST;

.OBJ.EXE:
	$(LINK) $**,$@;

.EXE.COM:
	$(EXE2BIN) $** $@

BOOT\BOOT.COM: BOOT\BOOT.ASM

BOOT\WBOOT.COM: BOOT\WBOOT.ASM

BOOT\BOOT2.COM: BOOT\BOOT.COM
	BOOT\WBOOT.COM BOOT\BOOT.COM

DEV\NULDEV.COM: DEV\NULDEV.ASM

DEV\KBDDEV.COM: DEV\KBDDEV.ASM

DEV\SCRDEV.COM: DEV\SCRDEV.ASM

DEV\CONDEV.COM: DEV\CONDEV.ASM

DEV\AUXDEV.COM: DEV\AUXDEV.ASM

DEV\COMDEV.COM: DEV\COMDEV.ASM

DEV\PRNDEV.COM: DEV\PRNDEV.ASM

DEV\LPTDEV.COM: DEV\LPTDEV.ASM

DEV\CLOCKDEV.COM: DEV\CLOCKDEV.ASM

DEV\DISKDEV.COM: DEV\DISKDEV.ASM

DEV\IBMBIO.OBJ: DEV\IBMBIO.ASM

DEV\IBMBIO.EXE: DEV\IBMBIO.OBJ
	$(LINK) @DEV\IBMBIO.LRF

DEV\IBMBIO.TMP: DEV\IBMBIO.EXE
	$(EXE2BIN) $** $@
	COPY /B BOOT\BOOT2.COM+DEV\NULDEV.COM+DEV\KBDDEV.COM+DEV\SCRDEV.COM+DEV\CONDEV.COM+DEV\AUXDEV.COM DEV\IBMDEV.TMP
	COPY /B DEV\IBMDEV.TMP+DEV\PRNDEV.COM+DEV\LPTDEV.COM+DEV\CLOCKDEV.COM+DEV\DISKDEV.COM+DEV\IBMBIO.TMP DEV\IBMBIO.COM
	DEL DEV\IBMDEV.TMP

DOS\CONIO.OBJ: DOS\CONIO.ASM

DOS\DOSINT.OBJ: DOS\DOSINT.ASM

DOS\IBMDOS.OBJ: DOS\IBMDOS.ASM

DOS\IBMDOS.EXE: DOS\DOSINT.OBJ DOS\CONIO.OBJ DOS\IBMDOS.OBJ
	$(LINK) @DOS\IBMDOS.LRF

DOS\IBMDOS.COM: DOS\IBMDOS.EXE
